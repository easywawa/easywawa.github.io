---
layout: post
category: kubernetes
title: sealoså¿«é€Ÿéƒ¨ç½²é«˜å¯ç”¨k8sé›†ç¾¤
tagline: by å™œå™œå™œ
tags: 
  - xx
published: true
---



<!--more-->

### ä¸€ã€ä»€ä¹ˆæ˜¯Sealos

`Sealos` æ˜¯ä¸€ä¸ª Go è¯­è¨€å¼€å‘çš„ç®€å•å¹²å‡€ä¸”è½»é‡çš„ `Kubernetes` é›†ç¾¤éƒ¨ç½²å·¥å…·ï¼Œ`Sealos` èƒ½å¾ˆå¥½çš„æ”¯æŒåœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²é«˜å¯ç”¨çš„ `Kubernetes` é›†ç¾¤ã€‚

`git`åœ°å€ï¼šhttps://github.com/fanux/sealos/

![img](https://img2018.cnblogs.com/blog/1747538/201910/1747538-20191014181419858-970575212.png)

### äºŒã€Sealosç‰¹æ€§ä¸ä¼˜åŠ¿

1. æ”¯æŒç¦»çº¿å®‰è£…ï¼Œå·¥å…·ä¸éƒ¨ç½²èµ„æºåŒ…åˆ†ç¦»ï¼Œæ–¹ä¾¿ä¸åŒç‰ˆæœ¬é—´å¿«é€Ÿå‡çº§ã€‚[**æœ€å¥½ä½¿ç”¨ç¦»çº¿å®‰è£…ï¼Œé¿å…å› ç½‘ç»œç¯å¢ƒå‡ºç°çš„é—®é¢˜**]
2. è¯ä¹¦æœ‰æ•ˆæœŸé»˜è®¤å»¶æœŸè‡³ 99 å¹´ã€‚
3. å·¥å…·ä½¿ç”¨éå¸¸ç®€å•ã€‚
4. æ”¯æŒä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œå¯çµæ´»å®Œæˆé›†ç¾¤ç¯å¢ƒå®šåˆ¶ã€‚
5. **ä½¿ç”¨å†…æ ¸è¿›è¡Œæœ¬åœ°è´Ÿè½½**ï¼Œç¨³å®šæ€§æé«˜ï¼Œæ•…éšœæ’æŸ¥ä¹Ÿæå…¶ç®€å•

### ä¸‰ã€è®¾è®¡åŸåˆ™å’Œå·¥ä½œåŸç†

##### 	1ã€é«˜å¯ç”¨çš„å®ç°

â€‹		`Sealos` é«˜å¯ç”¨å®ç°æ˜¯é€šè¿‡æœ¬åœ°è´Ÿè½½æ–¹å¼å®Œæˆçš„ã€‚æœ¬åœ°è´Ÿè½½å®ç°æ–¹å¼æœ‰å¤šç§ï¼Œæ¯”å¦‚ï¼š`IPVS`ã€`Envoy`ã€`Nginx` ç­‰ï¼Œè€Œ `Sealos` é‡‡ç”¨çš„æ˜¯é€šè¿‡å†…æ ¸ `IPVS` æ¥å®ç°çš„

`Sealos` é€‰æ‹©é€šè¿‡å†…æ ¸ `IPVS` æ¥å®ç°ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š

- å¦‚æœä½¿ç”¨ `Envoy` ç­‰éœ€è¦åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½è·‘ä¸€ä¸ªè¿›ç¨‹ï¼Œæ¶ˆè€—æ›´å¤šèµ„æºã€‚è™½ç„¶ `IPVS` å®é™…ä¸Šä¹Ÿä¼šå¤šè·‘ä¸€ä¸ª `lvscare` è¿›ç¨‹ ï¼Œä½†æ˜¯ `lvscare` åªæ˜¯è´Ÿè´£ç®¡ç† `IPVS` è§„åˆ™ï¼ŒåŸç†å’Œ `Kube-Proxy`ç±»ä¼¼ã€‚çœŸæ­£çš„æµé‡ç›´æ¥ä»å†…æ ¸å±‚é¢èµ°ï¼Œä¸éœ€è¦æŠŠæ•°æ®åŒ…å…ˆèµ°åˆ°ç”¨æˆ·æ€ä¸­å»å¤„ç†ã€‚
- ä½¿ç”¨ `Envoy` å­˜åœ¨å¯åŠ¨ä¼˜å…ˆçº§çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼šJoin é›†ç¾¤æ—¶ï¼Œå¦‚æœè´Ÿè½½å‡è¡¡æ²¡æœ‰å»ºç«‹ï¼ŒKubelet å°±ä¼šå¯åŠ¨å¤±è´¥ã€‚ä½¿ç”¨ `IPVS` åˆ™ä¸ä¼šå­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨ Join é›†ç¾¤å‰å…ˆå»ºç«‹å¥½è½¬å‘è§„åˆ™

##### 	2ã€æœ¬åœ°å†…æ ¸è´Ÿè½½å·¥ä½œåŸç†

â€‹		`Sealos` é€šè¿‡æœ¬åœ°å†…æ ¸è´Ÿè½½çš„æ–¹å¼å®ç°æ¯ä¸ª `Node` èŠ‚ç‚¹è´Ÿè½½å‡è¡¡è®¿é—®æ‰€æœ‰ `Master` èŠ‚ç‚¹

â€‹		åœ¨æ‰€æœ‰ `Node` èŠ‚ç‚¹ä¸Šå¯åŠ¨ä¸€ä¸ªåŒ…å« `lvscare` è¿›ç¨‹çš„ `Static Pod` å¯¹ `IPVS` è¿›è¡Œå®ˆæŠ¤ã€‚ å¦‚æœæ£€æµ‹åˆ° `ApiServer` ä¸å¯ç”¨æ—¶ï¼Œ`Sealos` ä¼šè‡ªåŠ¨æ¸…ç†æ‰æ‰€æœ‰ `Node` èŠ‚ç‚¹ä¸Šå¯¹åº”çš„ä¸»èŠ‚ç‚¹ `IPVS` è½¬å‘è§„åˆ™ã€‚ç›´åˆ° `Master` èŠ‚ç‚¹æ¢å¤æ­£å¸¸æ—¶ï¼Œå†è‡ªåŠ¨ç”Ÿæˆå¯¹åº”è§„åˆ™

##### 	3ã€Sealosçš„æ‰§è¡Œæµç¨‹

â€‹		é€šè¿‡ `SFTP` æˆ–è€… `Wget` å‘½ä»¤æŠŠç¦»çº¿å®‰è£…åŒ…æ‹·è´åˆ°ç›®æ ‡æœºå™¨ä¸Šï¼ŒåŒ…æ‹¬æ‰€æœ‰ `Master` å’Œ `Node` èŠ‚ç‚¹ã€‚

1. åœ¨ `Master 0` èŠ‚ç‚¹ä¸Šæ‰§è¡Œ `kubeadm init` å‘½ä»¤ã€‚
2. åœ¨å…¶å®ƒ `Master` èŠ‚ç‚¹ä¸Šæ‰§è¡Œ `kubeadm join` å‘½ä»¤å¹¶è®¾ç½®æ§åˆ¶é¢ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­å¤šä¸ª `Master` èŠ‚ç‚¹ä¸Šçš„ `Etcd` ä¼šè‡ªåŠ¨ç»„æˆä¸€ä¸ª `Etcd` é›†ç¾¤ï¼Œå¹¶å¯åŠ¨ç›¸åº”æ§åˆ¶ç»„ä»¶ã€‚
3. æ‰€æœ‰ `Node` èŠ‚ç‚¹éƒ½åŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šåœ¨ `Node` èŠ‚ç‚¹ä¸Šè¿›è¡Œ `IPVS` è½¬å‘è§„åˆ™å’Œ `/etc/hosts` é…ç½®ã€‚

> `Node` èŠ‚ç‚¹å¯¹ `ApiServer` çš„è®¿é—®å‡æ˜¯é€šè¿‡åŸŸåè¿›è¡Œçš„ã€‚å› ä¸º `Node` èŠ‚ç‚¹éœ€è¦é€šè¿‡ `è™šæ‹Ÿ IP` è¿æ¥åˆ°å¤šä¸ª `Master` ä¸Šï¼Œä½†æ˜¯æ¯ä¸ª `Node` èŠ‚ç‚¹çš„ `Kubelet` ä¸ `Kube-Proxy` è®¿é—® `ApiServer` çš„åœ°å€æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨åŸŸåæ¥è§£ææ¯ä¸ªèŠ‚ç‚¹ä¸Š `ApiServer` ä¸åŒçš„ `IP` åœ°å€ã€‚

### å››ã€éƒ¨ç½²

##### 	1ã€å®‰è£…ç›¸å…³ç¯å¢ƒä¾èµ–

â€‹		â‘ åœ¨æ‰€æœ‰è¦éƒ¨ç½²çš„æœºå™¨ä¸Šï¼Œå…ˆå®Œæˆ `Docker` çš„å®‰è£…å’Œå¯åŠ¨ã€‚ã€æ–°ç‰ˆæœ¬ä¸ç”¨è‡ªå·±å®‰è£…ã€‘

â€‹		â‘¡ä¸‹è½½ `Kubernetes` ç¦»çº¿å®‰è£…åŒ… ã€å®˜ç½‘çš„å®‰è£…åŒ…éœ€è¦è´­ä¹°https://www.sealyun.com/goodsDetail?type=cloud_kernel&name=kubernetesã€‘

â€‹		å…è´¹çš„ç¦»çº¿åŒ…åœ°å€ï¼šhttps://github.com/sealstore/cloud-kernel/releases/

```
wget -c https://sealyun.oss-cn-beijing.aliyuncs.com/7b6af025d4884fdd5cd51a674994359c-1.18.0/kube1.18.0.tar.gz  ##1.18ç‰ˆæœ¬
https://sealyun.oss-cn-beijing.aliyuncs.com/cf6bece970f6dab3d8dc8bc5b588cc18-1.16.0/kube1.16.0.tar.gz    ##1.16ç‰ˆæœ¬
```

â€‹		â‘¢ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ `Sealos`

```
wget -c https://sealyun.oss-cn-beijing.aliyuncs.com/latest/sealos && chmod +x sealos && mv sealos /usr/bin
```

```
å¸¸ç”¨å‚æ•°ï¼š
--master   Master èŠ‚ç‚¹æœåŠ¡å™¨åœ°å€åˆ—è¡¨ 
--node     Node èŠ‚ç‚¹æœåŠ¡å™¨åœ°å€åˆ—è¡¨ 
--user     æœåŠ¡å™¨ SSH ç”¨æˆ·å 
--passwd   æœåŠ¡å™¨ SSH ç”¨æˆ·å¯†ç  
--pkg-url  ç¦»çº¿åŒ…æ‰€åœ¨ä½ç½®ï¼Œå¯ä»¥æ˜¯æœ¬åœ°ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª HTTP åœ°å€ 
--version  æŒ‡å®šéœ€è¦éƒ¨ç½²çš„ Kubernetes ç‰ˆæœ¬ 
--pk       æŒ‡å®š SSH ç§é’¥æ‰€åœ¨ä½ç½®ï¼Œé»˜è®¤ä¸º /root/.ssh/id_rsa 

Other flags: 
 --kubeadm-config string   kubeadm-config.yaml ç”¨äºæŒ‡å®šè‡ªå®šä¹‰ kubeadm é…ç½®æ–‡ä»¶ 
 --vip string              virtual ip (default "10.103.97.2") æœ¬åœ°è´Ÿè½½æ—¶è™šæ‹Ÿ IP ï¼Œä¸æ¨èä¿®æ”¹ï¼Œé›†ç¾¤å¤–ä¸å¯è®¿é—®
```

â€‹		

â‘£å¯¹æ‰€æœ‰æœåŠ¡è¿›è¡Œæ—¶é—´åŒæ­¥

##### 	2ã€å¼€å§‹éƒ¨ç½²

â€‹	åˆ›å»ºéƒ¨ç½²è„šæœ¬

â€‹	cat init.sh

	sealos init --passwd '!QAZxsw2' \
	    --master 172.16.38.93  --master 172.16.38.95  --master 172.16.38.86  \
	    --node 172.16.38.89 \
	    --pkg-url /root/kube1.18.0.tar.gz \
	    --version v1.18.0
bash init.sh å®‰è£…å®Œæˆä¹‹åçš„ç•Œé¢ï¼š

![](https://img01.sogoucdn.com/app/a/100520146/2a7a6bd97df298a33df6c4c8f20d339c)

##### 3ã€æ‰©å®¹åŠç¼©å®¹

â‘ å¢åŠ master

```
ğŸ³ â†’ sealos join --master 192.168.0.6 --master 192.168.0.7
ğŸ³ â†’ sealos join --master 192.168.0.6-192.168.0.9  # æˆ–è€…å¤šä¸ªè¿ç»­IP
```

â‘¡å¢åŠ node

```
ğŸ³ â†’ sealos join --node 192.168.0.6 --node 192.168.0.7
ğŸ³ â†’ sealos join --node 192.168.0.6-192.168.0.9  # æˆ–è€…å¤šä¸ªè¿ç»­IP
```

â‘¢åˆ é™¤æŒ‡å®šçš„masterèŠ‚ç‚¹

```
ğŸ³ â†’ sealos clean --master 192.168.0.6 --master 192.168.0.7
ğŸ³ â†’ sealos clean --master 192.168.0.6-192.168.0.9  # æˆ–è€…å¤šä¸ªè¿ç»­IP
```

â‘£åˆ é™¤æŒ‡å®šçš„nodeèŠ‚ç‚¹

```
ğŸ³ â†’ sealos clean --node 192.168.0.6 --node 192.168.0.7
ğŸ³ â†’ sealos clean --node 192.168.0.6-192.168.0.9  # æˆ–è€…å¤šä¸ªè¿ç»­IP
```

â‘¤æ¸…ç†é›†ç¾¤

```
ğŸ³ â†’ sealos clean --all
```

### äº”ã€éªŒè¯éƒ¨ç½²æ˜¯å¦æˆåŠŸ

```
[root@master-1 ~]# kubectl get nodes
NAME                 STATUS   ROLES    AGE   VERSION
master-1.novalocal   Ready    master   14h   v1.18.0
master-2.novalocal   Ready    master   14h   v1.18.0
master-3.novalocal   Ready    master   14h   v1.18.0
worker-1.novalocal   Ready    <none>   14h   v1.18.0
```

```
[root@master-1 ~]# kubectl get pod --all-namespaces
NAMESPACE              NAME                                         READY   STATUS    RESTARTS   AGE
kube-system            calico-kube-controllers-84445dd79f-m54l8     1/1     Running   0          14h
kube-system            calico-node-7wcbf                            1/1     Running   0          14h
kube-system            calico-node-ftqv7                            1/1     Running   0          14h
kube-system            calico-node-gq74h                            1/1     Running   0          14h
kube-system            calico-node-tm5nc                            1/1     Running   0          14h
kube-system            coredns-66bff467f8-97j5r                     1/1     Running   0          14h
kube-system            coredns-66bff467f8-ckwcj                     1/1     Running   0          14h
kube-system            etcd-master-1.novalocal                      1/1     Running   0          14h
kube-system            etcd-master-2.novalocal                      1/1     Running   0          14h
kube-system            etcd-master-3.novalocal                      1/1     Running   0          14h
kube-system            kube-apiserver-master-1.novalocal            1/1     Running   0          14h
kube-system            kube-apiserver-master-2.novalocal            1/1     Running   0          14h
kube-system            kube-apiserver-master-3.novalocal            1/1     Running   1          14h
kube-system            kube-controller-manager-master-1.novalocal   1/1     Running   1          14h
kube-system            kube-controller-manager-master-2.novalocal   1/1     Running   0          14h
kube-system            kube-controller-manager-master-3.novalocal   1/1     Running   0          14h
kube-system            kube-proxy-78ls8                             1/1     Running   0          14h
kube-system            kube-proxy-cn6h7                             1/1     Running   0          14h
kube-system            kube-proxy-nlcph                             1/1     Running   0          14h
kube-system            kube-proxy-z6pnw                             1/1     Running   0          14h
kube-system            kube-scheduler-master-1.novalocal            1/1     Running   1          14h
kube-system            kube-scheduler-master-2.novalocal            1/1     Running   1          14h
kube-system            kube-scheduler-master-3.novalocal            1/1     Running   0          14h
kube-system            kube-sealyun-lvscare-worker-1.novalocal      1/1     Running   0          14h
```

### å…­ã€å®‰è£…å…¶ä»–app

##### 1ã€å®‰è£…Kuboard

`Kuboard`ï¼Œæ˜¯ä¸€æ¬¾å…è´¹çš„ Kubernetes å›¾å½¢åŒ–ç®¡ç†å·¥å…·ï¼ŒKuboard åŠ›å›¾å¸®åŠ©ç”¨æˆ·å¿«é€Ÿåœ¨ Kubernetes ä¸Šè½åœ°å¾®æœåŠ¡

å®‰è£…æ–‡æ¡£ï¼šhttps://kuboard.cn/install/install-dashboard.html#%E5%89%8D%E6%8F%90

**å…¼å®¹æ€§ï¼š**

| Kubernetes ç‰ˆæœ¬ | Kuboard ç‰ˆæœ¬    | å…¼å®¹æ€§ | è¯´æ˜                                                         |
| --------------- | --------------- | ------ | ------------------------------------------------------------ |
| v1.19           | v2.0.x          | ğŸ˜„      | å·²éªŒè¯                                                       |
| v1.18           | v1.0.xï¼Œ v2.0.x | ğŸ˜„      | å·²éªŒè¯                                                       |
| v1.17           | v1.0.xï¼Œ v2.0.x | ğŸ˜„      | å·²éªŒè¯                                                       |
| v1.16           | v1.0.xï¼Œ v2.0.x | ğŸ˜„      | å·²éªŒè¯                                                       |
| v1.15           | v1.0.xï¼Œ v2.0.x | ğŸ˜„      | å·²éªŒè¯                                                       |
| v1.14           | v1.0.xï¼Œ v2.0.x | ğŸ˜„      | å·²éªŒè¯                                                       |
| v1.13           | v1.0.xï¼Œ v2.0.x | ğŸ˜„      | å·²éªŒè¯                                                       |
| v1.12           | v1.0.xï¼Œ v2.0.x | ğŸ˜      | Kubernetes Api v1.12 ä¸æ”¯æŒ dryRunï¼Œ Kuboard ä¸æ”¯æŒ Kubernetes v1.12 |
| v1.11           | v1.0.xï¼Œ v2.0.x | ğŸ˜      | Kuboard ä¸æ”¯æŒ Kubernetes v1.11                              |

**å®‰è£…ï¼š**

```sh
kubectl apply -f https://kuboard.cn/install-script/kuboard.yaml
kubectl apply -f https://addons.kuboard.cn/metrics-server/0.3.7/metrics-server.yaml
```

**æŸ¥çœ‹kuboardè¿è¡ŒçŠ¶æ€ï¼š**

```sh
kubectl get pods -l k8s.kuboard.cn/name=kuboard -n kube-system  ##å¾—ç­‰å¾…å‡ ç§’
```

```
[root@master-1 ~]# kubectl get pods -l k8s.kuboard.cn/name=kuboard -n kube-system
NAME                       READY   STATUS    RESTARTS   AGE
kuboard-7986796cf8-lf8wc   1/1     Running   0          113m
```

##### **è·å–Token**

æ‚¨å¯ä»¥è·å¾—ç®¡ç†å‘˜ç”¨æˆ·ã€åªè¯»ç”¨æˆ·çš„Tokenã€‚

> - é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ ServiceAccount çš„ Token ç™»å½• Kuboard
> - æ‚¨è¿˜å¯ä»¥ [ä½¿ç”¨ GitLab/GitHub è´¦å·ç™»å½• Kuboard/Kubectl](https://kuboard.cn/learning/k8s-advanced/sec/authenticate/install.html)
> - æ‚¨ä¹Ÿå¯ä»¥ [ä¸ºç”¨æˆ·æˆæƒ](https://kuboard.cn/learning/k8s-advanced/sec/kuboard.html)

ç®¡ç†å‘˜ç”¨æˆ·ï¼š

```bash
echo $(kubectl -n kube-system get secret $(kubectl -n kube-system get secret | grep kuboard-user | awk '{print $1}') -o go-template='{{.data.token}}' | base64 -d)
```

**è®¿é—®Kuboard**

æ‚¨å¯ä»¥é€šè¿‡NodePortã€port-forward ä¸¤ç§æ–¹å¼å½“ä¸­çš„ä»»æ„ä¸€ç§è®¿é—® Kuboard

æ–¹å¼1ã€**é€šè¿‡NodePortè®¿é—®:**

Kuboard Service ä½¿ç”¨äº† NodePort çš„æ–¹å¼æš´éœ²æœåŠ¡ï¼ŒNodePort ä¸º 32567ï¼›æ‚¨å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼è®¿é—® Kuboard

- æ‚¨ä¹Ÿå¯ä»¥ä¿®æ”¹ Kuboard.yaml æ–‡ä»¶ï¼Œä½¿ç”¨è‡ªå·±å®šä¹‰çš„ NodePort ç«¯å£å·

```
http://ä»»æ„ä¸€ä¸ªWorkerèŠ‚ç‚¹çš„IPåœ°å€:32567/
```

æ–¹å¼2ã€**é€šè¿‡port-forwardè®¿é—®**

éœ€è¦æ‚¨å…ˆå®Œæˆ [ä»å®¢æˆ·ç«¯ç”µè„‘è¿œç¨‹ç®¡ç† Kubernetes](https://kuboard.cn/install/install-kubectl.html) çš„é…ç½®

åœ¨å®¢æˆ·ç«¯ç”µè„‘ä¸­æ‰§è¡Œï¼š

```sh
kubectl port-forward service/kuboard 8080:80 -n kube-system
```

è¯·ä½¿ç”¨ kubectl æ‰€åœ¨æœºå™¨çš„IPåœ°å€

http://localhost:8080

![](https://img02.sogoucdn.com/app/a/100520146/4cf855304ba9c9db7ddedbff5fd9b7ad)

> æ³¨ï¼škuboardæœ‰å¾ˆå¤šåŠŸèƒ½ï¼Œä¹‹åä¼šç»§ç»­



### ä¸ƒã€å‡çº§kubernetesç‰ˆæœ¬ ã€æœªéªŒè¯ï¼Œéœ€è°¨æ…ã€‘

`Kubernetes` é›†ç¾¤ç›®å‰å¤„äºä¸€ä¸ªé«˜é€Ÿè¿­ä»£æœŸï¼Œæ¯ä¸ªæ–°ç‰ˆæœ¬çš„å‘å¸ƒéƒ½æä¾›äº†ä¸å°‘æ–°çš„ç‰¹æ€§ã€‚å‡çº§ `Kubernetes` é›†ç¾¤ç‰ˆæœ¬ä¹Ÿå°±æˆäº†å®¶å¸¸ä¾¿é¥­ï¼Œ`Sealos` ä¹Ÿä¸ºå¤§å®¶æä¾›éå¸¸æ–¹ä¾¿çš„åŠŸèƒ½æ¥å¸®åŠ©å¤§å®¶å¿«é€Ÿå®Œæˆ `Kubernetes` é›†ç¾¤å‡çº§ã€‚`Kubernetes` é›†ç¾¤å‡çº§å¤§è‡´éœ€è¦ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤

##### 1ã€å‡çº§ Kubeadm

æŠŠç¦»çº¿åŒ…æ‹·è´åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ‰§è¡Œ cd kube/shell && sh init.shã€è¿™é‡Œä¼šæŠŠkubeadm kubectl kubelet binæ–‡ä»¶éƒ½æ›´æ–°æ‰ï¼Œè€Œä¸”ä¼šå¯¼å…¥é«˜ç‰ˆæœ¬é•œåƒã€‘

```
cd kube/shell && sh init.sh
```

##### 2ã€å‡çº§ Master èŠ‚ç‚¹ä¸Šçš„ Kubelet

å‡çº§ `Kubelet` è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œåªéœ€è¦æŠŠæ–°ç‰ˆæœ¬çš„ `Kubelet` å¤åˆ¶åˆ° `/usr/bin` ç›®å½•ä¸‹æ›¿æ¢æ—§ç‰ˆæœ¬ï¼Œç„¶åé‡å¯ `Kubelet` æœåŠ¡å³å¯

```
$ kubeadm upgrade plan 
$ kubeadm upgrade apply v1.16.0 # é‡å¯ Kubelet 
$ systemctl restart kubelet
```

å…¶ä¸­æœ€é‡è¦çš„ `kubeadm upgrade apply` å‘½ä»¤ä¸»è¦å®Œæˆä»¥ä¸‹ä¸€äº›æ“ä½œã€‚

- éªŒè¯é›†ç¾¤æ˜¯å¦å¯å‡çº§å¹¶æ‰§è¡Œç‰ˆæœ¬å‡çº§ç­–ç•¥ã€‚
- ç¡®è®¤ç¦»çº¿åŒ…ä¸­ç›¸å…³é•œåƒæ˜¯å¦å¯ç”¨ã€‚
- å¯¹æ§åˆ¶ç»„ä»¶çš„å®¹å™¨è¿›è¡Œå‡çº§ï¼Œå¤±è´¥å°±å›æ»šã€‚
- å¯¹ `Kube-DNS` å’Œ `Kube-Proxy` è¿›è¡Œå‡çº§ã€‚
- åˆ›å»ºæ–°çš„è¯ä¹¦æ–‡ä»¶å¹¶å¤‡ä»½æ—§çš„è¯ä¹¦æ–‡ä»¶ã€‚

##### 3ã€å‡çº§å…¶å®ƒ Master èŠ‚ç‚¹

```
kubeadm upgrade apply
```

##### 4ã€å‡çº§nodeèŠ‚ç‚¹

å‡çº§ `Node` èŠ‚ç‚¹å‰ï¼Œé¦–å…ˆè¦é©±é€èŠ‚ç‚¹ã€‚

```
$ kubectl drain $NODE --ignore-daemonsets
```

å…¶æ¬¡ï¼Œæ˜¯æ›´æ–° `Kubelet` çš„é…ç½®æ–‡ä»¶å’Œå‡çº§ `Node` èŠ‚ç‚¹çš„ `Kubelet`ã€‚

```
$ kubeadm upgrade node config --kubelet-version v1.16.0

# åŒæ ·æ˜¯æ›¿æ¢äºŒè¿›åˆ¶æ–‡ä»¶å¹¶é‡å¯ Kubelet
$ systemctl restart kubelet
```

æœ€åï¼Œæ¢å¤ `Node` èŠ‚ç‚¹ä¸ºå¯è°ƒåº¦çŠ¶æ€ã€‚

```
$ kubectl uncordon $NODE
```

##### 5ã€éªŒè¯é›†ç¾¤æ˜¯å¦å‡çº§æˆåŠŸ

```
 kubectl get nodes
```

