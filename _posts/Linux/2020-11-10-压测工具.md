---
layout: post
category: Linux
title: Linux中的压测工具
tagline: by 噜噜噜
tags: 
  - 
published: true
---



<!--more-->

### 一、磁盘压测工具 fio

##### 1、参数介绍

这里以乘坐电梯为例子：

```
filename：支持文件系统或者裸设备

direct：=1 绕过机器的缓存

iodepth：队列深度，只有使用libaio时才有意义。因为同步io的时候始终是1。就比如是一次乘坐电梯的人数。

numjob：线程数。就比如电梯的个数，与系统的cpu数和业务有关，需要测试的时候来调整

- ​	IO密集型：如果是IO密集型的任务，则应该设置可能多的线程数，由于IO操作不占用CPU，所以，不能让CPU闲下来。当然，如果线程数目太多，那么线程切换所带来的开销又会对系统的响应时间带来影响
- ​	CPU密集型：如果是CPU密集型的任务，我们应该设置数目较小的线程数，比如CPU数目加1

bs：单个IO的块大小，必须是512字节的倍数。就比如乘员人的体重

size：表示测试文件的总大小。比如是所有将要乘坐电梯和已经在电梯中的人员总人数。

runtime：测试时间，如果不配置，则将size指定大小的文件写完。如果设置了，则到时间为止

ioengine：libaio异步、psync同步

- ​	异步IO：一次提交多个IO请求，然后等待一批的完成。就比如一次电梯进入多个人
- ​	同步IO：一次只能提交一个IO请求，等待内核完成才返回。就比如一次只能上一个人

rw：randread、randwrite、randrw 、read 、write  、rw

rwmixwrite：在混合读写的模式下，写占的比例

group_reporting：关于显示结果的，汇总每个进程得信息

lockmem：限制内存
```



##### 2、测试结果分析

```
fio -ioengine=libaio -bs=4k -direct=1 -thread -rw=randwrite -size=1000G -filename=/dev/vdb -name="KingStack EBS 4K randwrite test" -iodepth=1 -runtime=60
```

![img](http://www.ksyun.com/blog/content/images/2017/09/iodepth1.png)

蓝色方框中是iops

绿色方框中是每个IO请求的平均响应时间

- slat: 提交延迟,submit某个I/O的延迟
- clat: 完成延迟, complete某个I/O的延迟
- lat: 响应时间,表示从fio将请求提交给内核，再到内核完成这个I/O为止所需要的时间

黄色方框中表示95%的IO请求的响应时间是小于等于0.474ms

紫色方框表示磁盘的使用率为91.85% ,还可以压榨



这里给出最终的结论: 

​	**当磁盘使用率不高的时候,可以增加队列深度,同时也会导致响应时间增高.但到一定程度后,IOPS反而会下降.**

```
增加队列深度，可以看到IOPS不会随着队列深度的增加而一直增加，达到一定值后会有所下降。 
增加队列深度，可以测试出磁盘的峰值
```



### 二、网络压测工具

### 三、连接数压测



### 

