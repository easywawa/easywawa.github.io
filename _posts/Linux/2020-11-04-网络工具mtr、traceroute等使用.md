---
layout: post
category: Linux
title: 网络工具mtr、traceroute的介绍与使用
tagline: by 噜噜噜
tags: 
  - xx
published: true
---



<!--more-->

`mtr`

结合了ping、tracert、nslookup工具

安装：yum install mtr -y

```
第一列是Host列，主要显示从本机到指定主机经过的路由信息

第二列是Loss%，显示路由到此IP的丢包率信息。需要注意的是有些丢包是ICMP的保护机制造成的

第三列是Snt，表示已发送的数据包数量

第四列是Last，显示最后一个包的延迟

第五列是Avg，显示平均延迟

第六列是Best，显示最低延迟

第七列是Wrst，显示最差延迟

第八列是StDev，显示标准偏差，越小网络越好
```

mtr www.baidu.com

![](https://s3.ax1x.com/2020/12/07/DxI3o4.png)





`traceroute`

### 一、作用

traceroute我们可以知道信息从你的计算机到互联网另一端的主机是走的什么路径。

每次数据包由某一同样的出发点（source）到达某一同样的目的地(destination)走的路径可能会不一样，但基本上来说大部分时候所走的路由是相同的

traceroute通过发送小的数据包到目的设备直到其返回，来测量其需要多长时间。**一条路径上的每个设备traceroute要测3次**。输出结果中包括每次测试的时间(ms)和设备的名称（如有的话）及其IP地址。

### 二、工作原理

1、首先，traceroute送出一个TTL是1的IP datagram（其实，每次送出的为3个40字节的包，包括源地址，目的地址和包发出的时间标签）到目的地，当路径上的第一个路由器（router）收到这个datagram时，它将TTL减1。

2、此时，TTL变为0了，所以该路由器会将此datagram丢掉，并送回一个「**ICMP time exceeded**」消息（包括发IP包的源地址，IP包的所有内容及路由器的IP地址）

3、traceroute 收到这个消息后，便知道这个路由器存在于这个路径上，接着traceroute 再送出另一个TTL是2 的datagram，发现第2 个路由器...... 

4、traceroute 每次将送出的datagram的TTL 加1来发现另一个路由器，这个重复的动作一直持续到某个数据报抵达目的地

5、Traceroute在送出`UDP datagrams`到目的地时，它所选择送达的port number 是一个一般应用程序都不会用的号码（30000 以上），所以当此UDP datagram 到达目的地后该主机会送回一个「**ICMP port unreachable**」的消息，而当traceroute 收到这个消息时，便知道目的地已经到达了



### 三、参数

traceroute[参数] [主机]

预设数据包大小是40Bytes，用户可另行设置。

`-I `使用ICMP回应取代UDP资料信息

`-m `设置检测数据包的最大存活数值TTL的大小，跳数设置

`-p `设置UDP传输协议的通信端口

`-n `直接使用IP地址而非主机名称显示，和tcpdump类似

`-r `忽略普通的Routing Table，直接将数据包送到远端主机上

### 四、使用

示例：traceroute 用法简单、最常用的用法

```
traceroute www.baidu.com
 1  gateway (172.16.38.254)  0.791 ms  0.748 ms  1.075 ms
 2  10.129.4.30 (10.129.4.30)  0.871 ms  0.878 ms  1.092 ms
 3  1.1.1.9 (1.1.1.9)  0.583 ms  0.589 ms  0.549 ms
 4  39.155.134.97 (39.155.134.97)  1.702 ms  1.679 ms  1.664 ms
 5  211.136.63.37 (211.136.63.37)  1.782 ms  1.753 ms  1.805 ms
 6  * * *
 7  39.156.27.5 (39.156.27.5)  4.119 ms *  4.191 ms
 8  39.156.27.1 (39.156.27.1)  4.235 ms  4.393 ms 39.156.67.45 (39.156.67.45)  4.882 ms
 9  * 39.156.67.13 (39.156.67.13)  4.270 ms 39.156.67.9 (39.156.67.9)  5.191 ms
10  * * *
。。。
```

说明：记录按序列号从1开始，每个纪录就是一跳 ，每跳表示一个网关，我们看到每行有三个时间，单位是 ms，默认是三个。也可以用`-q` 来指定

有时我们traceroute 一台主机时，会看到有一些行是以星号表示的。出现这样的情况，可能是防火墙封掉了ICMP的返回信息，所以我们得不到什么相关的数据包返回数据